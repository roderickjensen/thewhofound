var old_list="";(function($){$.fn.tweet=function(o){var s=$.extend({username:["seaofclouds"],list:null,favorites:false,avatar_size:null,count:3,fetch:null,intro_text:null,outro_text:null,join_text:" ",auto_join_text_default:"i said,",auto_join_text_ed:"i",auto_join_text_ing:"i am",auto_join_text_reply:"i replied to",auto_join_text_url:"i was looking at",loading_text:null,query:null,refresh_interval:null,twitter_url:"twitter.com",twitter_api_url:"api.twitter.com",twitter_search_url:"search.twitter.com",template:function(info){return info.user+info.join+info.text+info.time;},comparator:function(tweet1,tweet2){return tweet1.tweet_time-tweet2.tweet_time;},filter:function(tweet){return true;}},o);$.fn.extend({linkUrl:function(){var returning=[];var regexp=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;this.each(function(){returning.push(this.replace(regexp,function(match){var url=(/^[a-z]+:/i).test(match)?match:"http://"+match;return'<a href="'+url+'">'+match+"</a>";}));});return $(returning);},linkUser:function(){var returning=[];var regexp=/[\@]+([A-Za-z0-9-_]+)/gi;this.each(function(){returning.push(this.replace(regexp,'<a href="http://'+s.twitter_url+'/$1">@$1</a>'));});return $(returning);},linkHash:function(){var returning=[];var regexp=/(?:^| )[\#]+([A-Za-z0-9-_]+)/gi;this.each(function(){returning.push(this.replace(regexp,' <a href="http://'+s.twitter_search_url+'/search?q=&tag=$1&lang=all">#$1</a>'));});return $(returning);},capAwesome:function(){var returning=[];this.each(function(){returning.push(this.replace(/\b(awesome)\b/gi,'<span class="awesome">$1</span>'));});return $(returning);},capEpic:function(){var returning=[];this.each(function(){returning.push(this.replace(/\b(epic)\b/gi,'<span class="epic">$1</span>'));});return $(returning);},makeHeart:function(){var returning=[];this.each(function(){returning.push(this.replace(/(&lt;)+[3]/gi,"<tt class='heart'>&#x2665;</tt>"));});return $(returning);}});function parse_date(date_str){return Date.parse(date_str.replace(/^([a-z]{3})( [a-z]{3} \d\d?)(.*)( \d{4})$/i,"$1,$2$4$3"));}function relative_time(time_value){var parsed_date=parse_date(time_value);var relative_to=(arguments.length>1)?arguments[1]:new Date();var delta=parseInt((relative_to.getTime()-parsed_date)/1000,10);var r="";if(delta<60){r=delta+" seconds ago";}else{if(delta<120){r="a minute ago";}else{if(delta<(45*60)){r=(parseInt(delta/60,10)).toString()+" minutes ago";}else{if(delta<(2*60*60)){r="an hour ago";}else{if(delta<(24*60*60)){r=""+(parseInt(delta/3600,10)).toString()+" hours ago";}else{if(delta<(48*60*60)){r="a day ago";}else{r=(parseInt(delta/86400,10)).toString()+" days ago";}}}}}}return"about "+r;}function build_url(){var proto=("https:"==document.location.protocol?"https:":"http:");var count=(s.fetch===null)?s.count:s.fetch;var query=s.query;return proto+"//"+s.twitter_search_url+"/search.json?&q="+encodeURIComponent(query)+"&rpp="+count+"&callback=?";}return this.each(function(i,widget){var list=$('<ul class="tweet_list">').appendTo(widget);var intro='<p class="tweet_intro">'+s.intro_text+"</p>";var outro='<p class="tweet_outro">'+s.outro_text+"</p>";var loading=$('<p class="loading">'+s.loading_text+"</p>");if(typeof(s.username)=="string"){s.username=[s.username];}if(s.loading_text){$(widget).append(loading);}$(widget).bind("load",function(){$.getJSON(build_url(),function(data){if(s.loading_text){loading.remove();}if(s.intro_text){list.before(intro);}var tweets=$.map(data.results||data,function(item){var join_text=s.join_text;if(s.join_text=="auto"){if(item.text.match(/^(@([A-Za-z0-9-_]+)) .*/i)){join_text=s.auto_join_text_reply;}else{if(item.text.match(/(^\w+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&\?\/.=]+) .*/i)){join_text=s.auto_join_text_url;}else{if(item.text.match(/^((\w+ed)|just) .*/im)){join_text=s.auto_join_text_ed;}else{if(item.text.match(/^(\w*ing) .*/i)){join_text=s.auto_join_text_ing;}else{join_text=s.auto_join_text_default;}}}}}var screen_name=item.from_user||item.user.screen_name;var source=item.source;var user_url="http://"+s.twitter_url+"/"+screen_name;var tweet_id=item.id_str;var tweet_url="http://"+s.twitter_url+"/"+screen_name+"/statuses/"+item.id_str;var tweet_time=item.created_at;var tweet_relative_time=relative_time(tweet_time);var tweet_raw_text=item.text;var tweet_text=$([tweet_raw_text]).linkUrl().linkUser().linkHash()[0];var user='<a class="tweet_user" href="'+user_url+'">'+screen_name+"</a>";var join=((s.join_text)?('<span class="tweet_join"> '+join_text+" </span>"):" ");var time='<span class="tweet_time"><a href="'+tweet_url+'" title="view tweet on twitter">'+tweet_relative_time+"</a></span>";var text='<span class="tweet_text">'+$([tweet_text]).makeHeart().capAwesome().capEpic()[0]+"</span>";return{item:item,user_url:user_url,source:source,tweet_url:tweet_url,tweet_time:tweet_time,tweet_relative_time:tweet_relative_time,tweet_raw_text:tweet_raw_text,tweet_text:tweet_text,tweet_id:tweet_id,user:user,join:join,time:time,text:text};});tweets=$.grep(tweets,s.filter).slice(0,s.count);tweet_list=$.map(tweets.sort(s.comparator),function(t){return"<li id='"+t.tweet_id+"'>"+s.template(t)+"</li>";}).join("");tweet_list=$("<ul></ul>").append($(tweet_list));if(tweet_list.html()!=$(old_list).html()){list.quicksand($(tweet_list).find("li"),{attribute:"id"});old_list=tweet_list;}if(s.outro_text){list.after(outro);}$(widget).trigger("loaded").trigger((tweets.length===0?"empty":"full"));if(s.refresh_interval){window.setTimeout(function(){$(widget).trigger("load");},1000*s.refresh_interval);}});}).trigger("load");});};})(jQuery);